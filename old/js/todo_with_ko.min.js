var todo=function(e,t){return e=e||{},e.controller=e.controller||{},e.controller.createAndBindWidgetForTask=function(e,t){var n=t.newWidgetForTask(e.toDTO());return n.onToggleDoneRequest(function(t){e.done(t),e.save(function(e){n.done(e.done())})}),n},e.controller.AppController=function(t,n,r){r=r||e.controller.createAndBindWidgetForTask,this.start=function(e){t.forEach(function(e){r(e,n)},e),n.onNewTaskRequest(function(e){var i,s;i=t.newTask(e,function(){s.working(!1)}),s=r(i,n),s.working(!0)}),n.attachToDOM()}},e}(todo);var todo=function(e,t){return e=e||{},e.model=e.model||{},e.model.Tasks=function(t,n){var r=n||function(n){return new e.model.Task(n,t)},i=function(e){t.all(function(t){e(t.map(r))})};this.newTask=function(e,t){var n=r({description:e,done:!1});return n.save(function(e){t(e)}),n},this.forEach=function(e,t){i(function(n){var r=n.length;for(var i=0;i<r;i++)e(n[i]);typeof t=="function"&&t()})}},e.model.Task=function(e,t){var n=e.id,r=e.description,i=e.done;this.toDTO=function(){return{description:r,id:n,done:i}},this.done=function(e){return typeof e=="boolean"&&e!==i&&(i=!i),i},this.save=function(e){var r=this;t.save(r.toDTO(),function(t){n=t.id,e(r)})}},e}(todo);var todo=function(e,t){e=e||{},e.store=e.store||{};var n=function(){return"id"+Math.round(Math.random()*1e17)},r=function(e){return JSON.stringify(e)},i=function(e){return JSON.parse(e)},s=function(e,t){setTimeout(function(){t?e(t):e()},500)};return e.store.InMemoryStorage=function(){var e=[],t={},o=function(i,o){i.id=n(),t[i.id]=e.length,e.push(r(i)),s(o,i)};this.removeAll=function(e){s(e)},this.all=function(t){s(t,e.map(i))},this.save=function(n,i){var u=t[n.id];u?(e[u]=r(n),s(i,n)):o(n,i)}},e}(todo);Function.prototype.bind||(Function.prototype.bind=function(e){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r?this:e,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i});var todo=function(e,t){return e=e||{},e.utils=e.utils||{},e.utils.Event=function(){var e=[];this.subscribe=function(t){if(typeof t!="function")return;e.indexOf(t)===-1&&e.push(t)},this.publish=function(t){var n;e.forEach(function(e){try{e(t)}catch(n){console.log(n.toString(),n.stack)}})}},e.utils.field=function(t,n){var r=t,i=n||new e.utils.Event,s=function(e){if(typeof e!="undefined"){var t=r;return r=e,e!==t&&i.publish(r),s}return r};return s.subscribe=function(e){return i.subscribe(e),s},s},e}(todo);var todo=function(e,t){return e=e||{},e.widget=e.widget||{},e.widget.TaskWidget=function(t,n){var r=n||new e.utils.Event,i=function(){if(t.working())return;var e=!t.done();t.doneChk.checked(e),t.working(!0),r.publish(e)},s=function(){t.working(!1)},o=function(e){t.doneChk.enabled(!e)};this.done=t.done.bind(t),this.working=t.working.bind(t),this.onToggleDoneRequest=r.subscribe.bind(r),t.done.subscribe(s),t.working.subscribe(o),t.doneChk.checked.subscribe(i),t.onDescriptionClicked(i)},e.widget.CreateTaskWidget=function(t,n,r){var i=r||new e.utils.Event,s=function(e){n.enabled(!!e)},o=function(){var e=t.text();if(!e)return;t.text(""),i.publish(e)};this.onNewTaskRequest=i.subscribe.bind(i),this.focus=t.focus.bind(t),t.onKeyUp(function(e){e.keyCode===13&&o()}),t.text.subscribe(s),n.onClick(o),s(t.text())},e.widget.factory={newCreateTaskWidget:function(t,n){return new e.widget.CreateTaskWidget(t,n)},newTaskWidget:function(t){return new e.widget.TaskWidget(t)}},e.widget.AppWidget=function(t,n){var r=n||e.widget.factory,i=r.newCreateTaskWidget(t.newTaskDescription,t.addTaskBtn);this.newWidgetForTask=function(e){return r.newTaskWidget(t.newViewForTask(e))},this.onNewTaskRequest=i.onNewTaskRequest.bind(i),this.attachToDOM=function(){t.attachToDOM(),i.focus(!0)}},e}(todo);var todo=function(e,t){return e=e||{},e.view=e.view||{},e.view.ko=e.view.ko||{},e.view.ko.TextFieldViewModel=function(t,n){var r=new e.utils.Event;this.text=ko.observable(t),this.onKeyUp=r.subscribe.bind(r),this.focus=ko.observable(n),this.fireKeyUp=function(e,t){r.publish(t)}},e.view.ko.ButtonViewModel=function(t){var n=new e.utils.Event;this.enabled=ko.observable(t),this.onClick=n.subscribe.bind(n),this.fireOnClick=n.publish.bind(n)},e.view.ko.CheckboxViewModel=function(e,t){this.enabled=ko.observable(t),this.checked=ko.observable(e)},e.view.ko.TaskViewModel=function(t,n){this.descriptionClicked=new e.utils.Event,this.even=ko.observable(n),this.description=ko.observable(t.description),this.done=ko.observable(t.done),this.doneChk=new e.view.ko.CheckboxViewModel(t.done,!1),this.working=ko.observable(!1),this.onDescriptionClicked=this.descriptionClicked.subscribe.bind(this.descriptionClicked)},e.view.ko.AppViewModel=function(){this.taskViews=ko.observableArray([]),this.newTaskDescription=new e.view.ko.TextFieldViewModel("",!1),this.addTaskBtn=new e.view.ko.ButtonViewModel(!1),this.newViewForTask=function(t){var n=this.taskViews().length%2===0,r=new e.view.ko.TaskViewModel(t,n);return this.taskViews.push(r),r},this.attachToDOM=function(){ko.applyBindings(this)}},e}(todo);var storage=new todo.store.InMemoryStorage,storage=new todo.store.InMemoryStorage,domView=new todo.view.ko.AppViewModel,model=new todo.model.Tasks(storage),widget=new todo.widget.AppWidget(domView),app=new todo.controller.AppController(model,widget);window.underTest?(window.startApp=app.start.bind(app),window.testStorage=storage):app.start()